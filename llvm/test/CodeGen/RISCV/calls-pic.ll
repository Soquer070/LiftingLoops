; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: llc -mtriple riscv32 < %s | FileCheck --check-prefix=NO-PIC %s
; RUN: llc -mtriple riscv32 -relocation-model=pic < %s | \
; RUN:     FileCheck --check-prefix=PIC %s

@x = internal unnamed_addr global i32 42, align 4

define void @external_fun() {
entry:
  %0 = load i32, i32* @x, align 4
  %inc = add nsw i32 %0, 1
  store i32 %inc, i32* @x, align 4
  ret void
}


define internal void @internal_fun() {
entry:
  %0 = load i32, i32* @x, align 4
  %inc = add nsw i32 %0, 1
  store i32 %inc, i32* @x, align 4
  ret void
}


define signext i32 @test() {
; NO-PIC-LABEL: test:
; NO-PIC: call internal_fun
; NO-PIC: call external_fun
;
; PIC-LABEL: test:
; PIC: call internal_fun
; PIC: call external_fun@plt
entry:
  tail call void @internal_fun()
  tail call void @external_fun()
  %0 = load i32, i32* @x, align 4
  ret i32 %0
}

